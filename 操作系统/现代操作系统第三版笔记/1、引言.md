# 1、引言

### 1.1、操作系统概念、功能及其特征

#### 1.1.1、==操作系统概念==

- 操作系统负责管理协调硬件、软件等计算机资源的工作
- 为上层用户、应用程序提供简单易用的服务
- 是一种系统软件

#### 1.1.2、 ==操作系统的功能与目标==

- **作为系统资源的管理者**

  - **提供的功能**：
    - 处理机（CPU)管理
    - 存储器管理
    - 文件管理
    - 外部设备管理
  - **目标：安全高效**

- **向上层提供方便易用的服务**

  - **图像化用户接口（GUI）**：使用形象的图形界面进行操作，不需要记忆复杂的命令、参数。
  - **命令接口**：通过命令行方式调用操作系统
    - **联机命令接口**：用单个命令行的方式和操作系统进行交互。特点是**用户说一句，系统做一句**。
    - **脱机命令接口**：用批处理命令行的方式和操作系统进行交互。特点是**用户说一堆，系统做一堆**。
  - **程序接口**：可以在程序中进行**系统调用**来使用程序接口。普通用户不能直接使用程序接口，只能程序代码间接使用。

  > 程序接口和命令接口统称为**用户接口**

- **对硬件机器的扩展**
  - 在没有任何软件支持的计算机——裸机安装上操作系统，可以提供资源管理器功能和方便用户的服务功能，将裸机改造成功能更强、使用更方便的机器。
  - 通常把覆盖了软件的机器称为**虚拟器**。

#### 1.1.3、==操作系统的特征==

- **并发**

  - 并发是指**两个或多个程序**在**同一时间间隔内**运行，这些程序在宏观上是同时运行的，但在微观上是**交替运行**的。单核CPU同一时刻只能执行一个程序，各个程序只能并发执行。
  - 与并行的概念不同，并行是多个事件在**同一时刻**发生。多核CPU在同一时刻可以同时执行多个程序，多个程序可以并行地执行。

- **共享**：即资源共享，指系统中的资源可供内存中多个并发执行的进程使用

  - **互斥共享方式**：一个时间段内只允许一个进程进行访问该资源，比如说摄像头。
  - **同时共享方式：**一个时间段内允许多个进程交替对该资源进行访问。比如说硬盘。

  > 如果没有并发，那么共享就无法实现；如果没有共享，那么并发就没有意义，所以**并发性和共享性是互为存在条件的**。

- **虚拟**：把一个物理上的实体变为若干个逻辑上的对应物，使得系统可以在逻辑上支持更多的程序运行。
  - **空分复用技术**：通过将多个进程或任务在同一物理资源（如内存、处理器等）上进行分时共享，从而实现高效的资源使用和优化性能。
  - **时分复用技术：**它允许多个进程在同一时间段内使用 CPU，从而提高系统的响应能力和资源利用率。
  - 虚拟性实际上就是并发的应用。
- **异步**：在多个程序并发执行下，由于资源有限，进程的执行不是一贯到底的，而是走走停停，以不可预知的速度向前推进，这就是进程的异步性。

### 1.2、操作系统的发展与分类

- **手工操作阶段**：

  - 手工装取打孔纸带，纸带机对打孔纸带进行读写，最后计算机进行计算。
  - **主要缺点：**用户独占全机，人机速度矛盾导致资源利用率极低。

- **批处理阶段：**

  - **单道批处理阶段**（操作系统的雏形）

    - 引用**脱机输入/输出技术**，并由**监督程序**负责控制作业的输入输出。
    - **主要优点：**缓解了一定程度的人机速度矛盾，资源利用率有所提升。
    - **主要缺点**：**内存中仅能有一道程序运行**，只有该程序运行结束之后才能调入下一道程序。**CPU有大量时间是在空闲等待I/O完成**。资源利用率依然很低。

    ![image-20240803215257778](C:\Users\di\Desktop\新建文件夹\image-20240803215257778.png)

  - **多道批处理系统**（操作系统正式诞生，用于支持多道程序并发运行）

    - 想比于单道批处理操作系统，它每次往内存读入多道程序。
    - **主要优点：**多道程序并发执行，共享计算机资源。资源利用律大幅提升，CPU和其他资源更能保持忙碌状态，系统吞吐量增大。
    - **主要缺点：**用户响应时间长，**没有人机交互功能，计算机执行期间不能控制自己的作业**。

    ![image-20240803215942978](C:\Users\di\Desktop\新建文件夹\image-20240803215942978.png)

- **分时操作系统**
  - 计算机以**时间片**为单位轮流为各个用户/作业服务，各个用户可以通过终端与计算机进行交互。
  - **主要优点**：用户请求可以被随时响应，**解决了人机交互问题。**运行多个用户同时使用同一台计算机，用户对计算机的操作相互独立。
  - **主要缺点：不能优先处理一些紧急任务**，操作系统对各个用户/作业都是完全公平的。
- **实时操作系统**
  - **主要优点**：能够优先响应一些紧急任务，某些紧急任务不需时间片排序。
    - **硬实时系统：**必须在绝对严格的规定时间内完成任务（导弹控制系统，自动驾驶系统）
    - **软实时系统**：能偶尔违反时间规定。



### 1.3、操作系统的运行机制

#### 1.3.1、==内核态与用户态的转换==

> **应用程序：**由普通程序员写的程序。
>
> **内核程序：**是操作系统最重要最核心的部分，也是最接近硬件的部分。

- **特权指令与非特权指令**
  - **特权指令：**这种指令影响重大，只允许管理者——即操作系统内核来使用。比如内存清零指令。
  - **非特权指令：**例如加法指令、减法指令等，应用程序只能使用非特权指令。
- **用户态和内核态**（CPU的两种状态）
  - CPU中有一个**程序状态寄存器（PSW）**，其中有个二进制位可以区分内核态和用户态。
  - 当用户处于**用户态**时，说明此时正在运行的是应用程序，**此时只能执行非特权指令**。
  - 当用户处于**内核态时**，说明此时正在运行的是内核程序，**此时可以执行特权指令**。
- **用户态和内核态的转换**
  - **内核态转为用户态**：操作系统内核在让出CPU之前，会用一条特权指令**把PSW的标志位设置为用户态**。
  - **用户态转为内核态**：由**中断**引发，硬件自动完成变态过程，比如在用户态执行特权指令会造成中断。

#### 1.3.2、==中断和异常==

- **中断的作用**：
  - 中断是**让操作系统内核重新夺回CPU使用权**的唯一途径。
  - 中断会将CPU从用户态变为内核态。
- **中断的分类**
  - **内中断**（也称异常）：与当前执行的指令有关，中断信号来自系统内部。
    - **陷阱、陷入（trap）**：由陷入指令引发，是程序故意引发的。
    - **故障（fault）**：由错误条件引起，可能会被内核程序修复。内核程序修复后会将CPU使用权还给应用程序。
    - **终止（abort）**：由致命错误引起，内核程序无法修复该错误。因此会直接终止该应用程序。比如整数除0、非法使用特权指令。
  - **外中断（狭义上的中断）**：中断信号来自CPU外部。
    - **时钟中断**：时钟部件每隔一个时间片会给CPU发送一个时钟中断信号，来保证程序并发运行。
    - **I/O中断请求**：由输入输出设备发来的中断信号。
- **中断机制的基本实现原理**
  - **检查中断信号**：
    - **内中断的检查**：CPU在执行指令时会检查是否有异常发生。
    - **外中断的检查：**在每一个指令周期末尾，CPU都会检查是否有外中断信号进行处理。
  - **找到相应的中断处理程序**：通过**中断向量表**实现。

#### 1.3.3、==系统调用==

> 系统调用是**操作系统提供给应用程序使用的接口，应用程序可以通过系统调用来请求获得操作系统内核的服务**。

- **系统调用与库函数的区别**：在编程语言中，有的库函数会将系统调用封装起来，隐藏系统调用的一些细节，使程序员编程更加方便。
- **需要系统调用实现的功能：**凡是与共享资源有关的操作、会直接影响到其他进程的操作，就一定需要操作系统介入，那么这些功能就需要通过系统调用来实现。比如内存管理。
- **系统调用的过程：**
  - **传参指令：**将系统调用需要的参数放到某些通用寄存器中。
  - **陷入指令**：用户程序发出内中断信号，用户态转变为核心态。
  - **内核程序处理相关指令**：内核程序会根据寄存器中的参数判断用户需要哪种系统调用服务，然后执行相关程序。
  - **返回应用程序**



### 1.4、操作系统的体系结构

#### 1.4.1、==操作系统的内核==

> **内核**是操作系统最基本、最核心的部分。实现操作系统内核功能的那些程序就是内核程序

- **与硬件关联较紧密的模块：**
  - **时钟管理：**负责计时功能。
  - **中断处理：**负责实现中断机制。
  - **原语**
    - 处于操作系统最底层，是最接近硬件的部分。
    - 这种程序的运行具有原子性。
    - 运行时间较短，调用频繁。
  - 只包含以上模块的内核叫做**微内核**。
- **对系统资源进行管理的功能**
  - 进程管理
  - 存储器管理
  - 设备管理
  - 包含所有内核模块的内核叫做**大内核**。

> 由于内核程序只能运行在内核态，所有用户程序在调用系统资源时，大内核与微内核消耗的资源大小不同，微内核**需要频繁地在核心态和用户态之间转换，性能低**

#### 1.4.2、==其他类型内核==

![image-20240910170136319](C:\Users\di\Desktop\新建文件夹\image-20240910170136319.png)



### 1.5、操作系统引导

> **Q：什么是操作系统引导？**
>
> A：操作系统引导（boot）是为了开机的时候让操作系统运行起来。

![image-20240911170516223](C:\Users\di\Desktop\新建文件夹\image-20240911170516223.png)



### 1.6、虚拟机

**两类虚拟机：**

![image-20240911173012341](C:\Users\di\Desktop\新建文件夹\image-20240911173012341.png)

**两类虚拟机间的对比：**

![image-20240911173113424](C:\Users\di\Desktop\新建文件夹\image-20240911173113424.png)
